<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Postulación Red Psicólogos Católicos</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary-900: #001A55;
    --primary-500: #0966FF;
    --bg-page: #F6F8FC;
    --bg-surface: #FFFFFF;
    --text-primary: #0B1220;
    --text-secondary: #475569;
    --border-color: #D9E2F1;
    --error-color: #DC2626;
  }
  * { box-sizing: border-box; outline: none; }

  body {
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-page);
    color: var(--text-primary);
    margin: 0; padding: 20px;
    display: flex; justify-content: center;
  }
  .cz-card {
    background: var(--bg-surface);
    width: 100%; max-width: 800px;
    border-radius: 16px;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
    overflow: hidden;
    border: 1px solid var(--border-color);
  }
  .cz-header {
    background: var(--primary-900);
    padding: 40px 30px;
    text-align: center;
    color: white;
  }

  .cz-header h2 { margin: 0 0 10px 0; font-weight: 700; font-size: 1.75rem; }
  .cz-header p { margin: 0; opacity: 0.9; font-weight: 300; font-size: 1rem; }
  .cz-body { padding: 40px 30px; }
  .cz-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

  /* Campos */
  .cz-group { display: flex; flex-direction: column; margin-bottom: 5px; }
  .cz-group.full { grid-column: span 2; }

  .cz-label {
    font-size: 0.85rem; font-weight: 600; margin-bottom: 6px;
    color: var(--primary-900);
  }

  .cz-input, .cz-select, .cz-textarea {
    padding: 12px 16px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    font-family: 'Inter', sans-serif;
    font-size: 0.95rem;
    color: var(--text-primary);
    background: #FAFAFA;
    transition: all 0.2s ease;
  }
  .cz-input:focus, .cz-select:focus, .cz-textarea:focus {
    background: #fff;
    border-color: var(--primary-500);
    box-shadow: 0 0 0 3px rgba(9, 102, 255, 0.1);
  }
  .cz-textarea { resize: vertical; min-height: 100px; }
  .cz-error-msg {
    color: var(--error-color); font-size: 0.75rem; margin-top: 4px; min-height: 18px;
  }

  .cz-checkbox-wrapper {
    display: flex; align-items: flex-start; gap: 10px;
    padding: 15px; background: #EEF3FF; border-radius: 8px;
    margin-top: 10px;
  }

  .cz-checkbox-wrapper input { margin-top: 4px; accent-color: var(--primary-500); cursor: pointer; }
  .cz-checkbox-wrapper label { font-size: 0.9rem; color: var(--text-secondary); cursor: pointer; line-height: 1.4; }
  .cz-checkbox-wrapper a { color: var(--primary-500); text-decoration: none; font-weight: 600; }
  /* Botón */
  .cz-footer {
    margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color);
    text-align: right;
  }
  .cz-btn {
    background: var(--primary-500); color: white;
    border: none; padding: 14px 28px; border-radius: 50px;
    font-size: 1rem; font-weight: 600; cursor: pointer;
    box-shadow: 0 4px 12px rgba(9, 102, 255, 0.3);
    transition: transform 0.2s, background 0.2s;
  }
  .cz-btn:hover { background: var(--primary-900); transform: translateY(-2px); }
  .cz-btn:disabled { opacity: 0.6; cursor: wait; transform: none; }
  /* Mensajes de estado */
  .cz-alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none; text-align: center; }
  .cz-alert.success { background: #DCFCE7; color: #166534; border: 1px solid #BBF7D0; }
  .cz-alert.error { background: #FEE2E2; color: #991B1B; border: 1px solid #FECACA; }
  .hidden { display: none; }
  @media (max-width: 600px) { .cz-grid { grid-template-columns: 1fr; } .cz-group.full { grid-column: span 1; } }
</style>
</head>
<body>
<div class="cz-card">
  <div class="cz-header">
    <h2>Postulación Profesional</h2>
    <p>Únete a la Red de Psicólogos Católicos</p>
  </div>
  <div class="cz-body">
    <div id="msgSuccess" class="cz-alert success">
      <strong>✅ ¡Solicitud enviada con éxito!</strong><br>
      Revisa tu correo electrónico para acceder al Examen E1.
    </div>
    <div id="msgError" class="cz-alert error">
      ⚠️ Hubo un problema al enviar. Por favor verifica tu conexión e inténtalo de nuevo.
    </div>
    <form id="admissionForm" novalidate>
      <div class="cz-grid">

        <div class="cz-group">
          <label class="cz-label">Nombre Completo *</label>
          <input type="text" id="full_name" class="cz-input" placeholder="Ej. Juan Pérez" required>
          <div class="cz-error-msg" id="err_full_name"></div>
        </div>
        <div class="cz-group">
          <label class="cz-label">Correo Electrónico *</label>
          <input type="email" id="email" class="cz-input" placeholder="nombre@ejemplo.com" required>
          <div class="cz-error-msg" id="err_email"></div>
        </div>
        <div class="cz-group">
          <label class="cz-label">Teléfono / WhatsApp *</label>
          <input type="tel" id="phone" class="cz-input" placeholder="+52 ..." required>
          <div class="cz-error-msg" id="err_phone"></div>
        </div>
        <div class="cz-group">
          <label class="cz-label">Fecha de Nacimiento *</label>
          <input type="date" id="birth_date" class="cz-input" required>
          <div class="cz-error-msg" id="err_birth_date"></div>
        </div>
        <div class="cz-group">
          <label class="cz-label">País de Residencia *</label>
          <select id="country" class="cz-input" required onchange="toggleOther('country')">
            <option value="">-- Seleccionar --</option>
            <option value="México">México</option>
            <option value="Colombia">Colombia</option>
            <option value="Argentina">Argentina</option>
            <option value="Chile">Chile</option>
            <option value="España">España</option>
            <option value="USA">Estados Unidos</option>
            <option value="other">Otro...</option>
          </select>
          <input type="text" id="country_other" class="cz-input hidden" placeholder="Escribe tu país" style="margin-top:5px;">
          <div class="cz-error-msg" id="err_country"></div>
        </div>
        <div class="cz-group">
          <label class="cz-label">Perfil Profesional *</label>
          <select id="professional_type" class="cz-input" required onchange="toggleOther('professional_type')">
            <option value="">-- Seleccionar --</option>
            <option value="Psicólogo/a">Psicólogo/a</option>
            <option value="Psiquiatra">Psiquiatra</option>
            <option value="Consejero/a">Consejero/a</option>
            <option value="Terapeuta Familiar">Terapeuta Familiar</option>
            <option value="other">Otro...</option>
          </select>
          <input type="text" id="professional_type_other" class="cz-input hidden" placeholder="Escribe tu profesión" style="margin-top:5px;">
          <div class="cz-error-msg" id="err_professional_type"></div>
        </div>
        <div class="cz-group full">
          <label class="cz-label">Enfoque Terapéutico *</label>
          <textarea id="therapeutic_focus" class="cz-textarea" placeholder="Ej. TCC, Humanista, Sistémico, Logoterapia..." required></textarea>
          <div class="cz-error-msg" id="err_therapeutic_focus"></div>
        </div>
        <div class="cz-group full">
          <label class="cz-label">Breve Reseña (Sobre ti) *</label>
          <textarea id="about_you" class="cz-textarea" placeholder="Cuéntanos brevemente tu experiencia y motivación..." required></textarea>
          <div class="cz-error-msg" id="err_about_you"></div>
        </div>
        <div class="cz-group">
          <label class="cz-label">Fecha estimada para Examen E1 *</label>
          <input type="date" id="scheduled_date_e1" class="cz-input" required>
          <div class="cz-error-msg" id="err_scheduled_date_e1"></div>
        </div>
        <div class="cz-group full">
          <div class="cz-checkbox-wrapper">
            <input type="checkbox" id="terms" required>
            <label for="terms">
              He leído y acepto el <a href="#" target="_blank">Aviso de Privacidad</a> y los <a href="#" target="_blank">Términos y Condiciones</a> de la Red.
            </label>
          </div>
          <div class="cz-error-msg" id="err_terms"></div>
        </div>
      </div>
      <div class="cz-footer">
        <button type="submit" id="submitBtn" class="cz-btn">Enviar Postulación ➜</button>
      </div>
    </form>
  </div>
</div>
<script>
  // URL DE TU PROXY (ACTUALIZA SEGÚN TU SERVIDOR)
  const API_URL = '../../proxy2.php';

  function toggleOther(fieldId) {
    const select = document.getElementById(fieldId);
    const otherInput = document.getElementById(fieldId + '_other');
    if (select.value === 'other') {
      otherInput.classList.remove('hidden');
      otherInput.required = true;
    } else {
      otherInput.classList.add('hidden');
      otherInput.required = false;
      otherInput.value = '';
    }
  }

  document.getElementById('admissionForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    // Reset errores
    document.querySelectorAll('.cz-error-msg').forEach(el => el.innerText = '');
    document.getElementById('msgError').style.display = 'none';
    document.getElementById('msgSuccess').style.display = 'none';
    let valid = true;
    const fields = ['full_name', 'email', 'phone', 'birth_date', 'country', 'professional_type', 'therapeutic_focus', 'about_you', 'scheduled_date_e1'];

    // Validación básica
    fields.forEach(id => {
      const el = document.getElementById(id);
      if (!el.value) {
        document.getElementById('err_' + id).innerText = 'Este campo es obligatorio';
        valid = false;
      }
    });
    if (!document.getElementById('terms').checked) {
      document.getElementById('err_terms').innerText = 'Debes aceptar los términos';
      valid = false;
    }
    if (!valid) return;

    // Preparar payload
    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    btn.innerText = "Enviando...";

    const getVal = (id) => {
      const el = document.getElementById(id);
      if (el.tagName === 'SELECT' && el.value === 'other') {
        return document.getElementById(id + '_other').value;
      }
      return el.value;
    };

    const payload = {
      action: 'handleRegistration',
      nombre: getVal('full_name'),
      email: getVal('email'),
      telefono: getVal('phone'),
      categoria: getVal('professional_type'),
      caminoAcademico: getVal('therapeutic_focus'),
      caminoEspiritual: getVal('about_you')
    };

    try {
      const res = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if (data.success) {
        document.getElementById('msgSuccess').style.display = 'block';
        document.getElementById('admissionForm').reset();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        throw new Error(data.error || 'Error desconocido');
      }
    } catch (err) {
      console.error(err);
      document.getElementById('msgError').innerText = '⚠️ Error: ' + (err.message || 'No se pudo conectar.');
      document.getElementById('msgError').style.display = 'block';
    } finally {
      btn.disabled = false;
      btn.innerText = "Enviar Postulación ➜";
    }
  });
</script>
</body>
</html>